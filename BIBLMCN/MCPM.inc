;Упрощенные варианты установления отношений множеств далее переработать
;УстановитьОтношенияМножеcтв
;M!CMPbJm  GA,GB, Kd,PS,ka,kb,m1,m2,m3,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14

; C!MPMalblJm  al,bl,Koord,[Kod],P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14  Сравнение двух множеств
;***********************УстановитьОтношенияБайтовыхМножетв+C!MPMalblJm*************************
;**************************** Форма обращения к ОПЕРАТОРУ
;	УстановитьОтношенияБайтовыхМножеcтв \
;			al ? bl\
;	=[Grn_d]	=[Ko_b]	=[Ka_b]	=[Kb_b]	=[m1_b]	=[m2_b]	=[m3_b]\
;=>P1  =>P2  =>P3 =>P4  =>P5  =>P6  =>P7  =>P8  =>P9 =>P10  =>P11  =>P12 =>P13  =>P14
;
;Базовый макрос для верхнего обращения после реструктуризации
; M!CMPbJm  A,B,[Grn_d],[Ko_b],[Ka_b],[Kb_b],[m1_b],[m2_b],[m3_b],P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14
;********************************************************************************
MACRO УстановитьОтношенияБайтовыхМножеcтв arg
{
	common match  GA==? GB == Kd ==PS ==ka ==kb ==m1 ==m2 ==m3\
==>P1 ==>P2 ==>P3 ==>P4 ==>P5 ==>P6 ==>P7 ==>P8 ==>P9 ==>P10 ==>P11==>P12 ==>P13 ==>P14,arg
\{
M!CMPbJm  \GA,\GB,\Kd,\PS,\ka,\kb,\m1,\m2,\m3,\P1,\P2,\P3,\P4,\P5,\P6,\P7,\P8,\P9,\P10,\P11,\P12,\P13,\P14
\}
}
;************************************************ M!CMPbJm   *******************

;**************************** Форма обращения к ОПЕРАТОРУ
;	УстановитьОтношенияБайтовыхМножеcтвиПерейти \
;	A ? B\
;=>P1  =>P2  =>P3 =>P4  =>P5  =>P6  =>P7  =>P8  =>P9 =>P10  =>P11  =>P12 =>P13  =>P14
;Перед входом определить _V1,_V2,.......,_V11,_V12,V13,V14 - код ответа
;либо 	C!MPMalblJm  A,B,Kd,PS,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14,K1,K2,K3,K4,K5,K6,K7,K8,K93,K11,K12,K13,K14
;Базовый макрос для верхнего обращения после реструктуризации
;	C!MPMalblJm  A,B,Kd,PS,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14
;********************************************************************************
; Исходные множества  A  B входная информация
;ВЫХОДНАЯ
;Кd  	00 00 ЧислоЕдиницA ЧислоЕдиницB
;Kd+4	m1 m2     m3		 0
;Kd+8	[A (B	  b) 		a]
;Ps	_Vi c учетом адреса перехода
MACRO C!MPMalblJm  GA,GB, Kd,PS,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14
{
   LOCAL	P6BA,Pr8,Pr7,Pr6,Pr5,Pr4,Pr3,Pr2,Pr1,Pr0,P8BA
	УпряталиРегистры	EAX,EBX,ECX,EDX,EBP
			movzx	EBX,GB		;2-й операнд
			movzx	EAX,GA		;1-й операнд
	;Операция: Число_единиц_в (EAX,ECX)	AL\ 		?(A)
		NEDinB	al,DH		;=> DH	=kA
	; Операция:  Число_единиц_в	BL\		?(B)
		NEDinB	BL,DL		;=> DL	kB
		mov	[Kd],EDX		;DX=kA,kB
		and	al,0FFh			;A&E
	jne	@F
		and	bl,0FFh			;B&E
	jne	Pr1				;JmJ	A=0 B#0 => A<B закончили
	jmp	Pr0				;JeJ  	A=0  B=0   A=B
@@:
		and	bl,0FFh
	je	Pr2				;JgJ	A#0 B=0 => A>B закончили
;*********
						;mov	BH,AL  	чтобы A(bh)  B(bl) были в одной строке
		mov	CL,AL
		xor	CL,BL		;в CL маска
					;AxorB=>N1-получим несовпадающие б. в A,B
	je	Pr3				;JeJ  	оба операнда A=B ==>
;**************Далее нетривиальные ситуации**********
					;NEDinB	BYTE,KO
					; Операция:Число_единиц_в	СL\
		NEDinB	CL,DH		;=> DH	m1  число в DH
	mov	CH,AL			;в СН совпадающие биты
	and	CH,BL			; A & B  => N2  - получение совпадающих бит в  A и  B
					; Операция:Число_единиц_в	СH\
		NEDinB	CH,DL			;p=> DL	m2  в DH
	mov	DL,AL			;  AH  все биты и вA  и в B
	or	DL,BL			;A  v B  => N3 - получение бит присутствующих в A и  B
					; Операция:Число_единиц_в	AH\
		mov	BP,DX
		shl	EBP,16
		NEDinB	DL,DH		;=> DH
		mov	BP,Dx		;m3
		and	BP,0FF00h
		mov	[Kd+4],EBP		;EDX= m1, m2, m3, 0
		and	BL,CL		;после выделения маски A
	jne	@F			;A маскир. пересекается с маскированное
					;А либо  погружено и нет  1, либо они не зависимы
	jmp	Pr4			;II направл. JgJ;in B=0 A>B  B?A  B в A зависимы
@@:
		and	AL,CL		;[5 ]	A(bh)
	je	Pr5			; II направление: JmJ		 A?B  	A<B
;*************************Есть пересекающиеся и не пересекающиеся разряды ***
		and	CH,0FFh		; A & B  => N2  - получение совпадающих бит в  A и  B
	jz	Pr6				; III направление: нет пересекающихся разрядов
;******************************IV направление*************************
;***Есть совпадающие ************** Pr7	  +  	Pr8   И то и другое
		bsf	BP,AX		;A
		shl	BP,8
		bsf	CX,BX		;B
		or	BP,CX		;A  B

		bsr	CX,AX		;A	старшие разряды
		shl	CX,8
 		bsr	DX,BX		; старшие	А  В
		or	CX,DX
		mov	DX,CX		;DX  старшие	А  В
		shl	ECX,16
		mov	CX,BP
		mov	[Kd+8],ECX		;==  границы [A(B b)a]
		cmp	dl,dh		;B  A номера старших единичек
	JG	P8BA			;B=1 A=0  =>A<B верхняя B больше A  (B [A
					;B=0 A=1  =>A>B
;*************  Pr7
		cmp	cl,ch		;номера младших единичек [A (B
	jL	@F			; [A (B ] b)
		mov	PS,_V11		;[A (B b) a]
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
	jmp	P11			;[A (B b) a]	A>B
;***  Координаты границ в Koordint
;*** Закончили с комб. Pr6ABba и пересечение до [A , после до (B, после до b) и до a]
;*******************  			[A     (B	 a]	 b)
@@:
					;[A(B b)a]
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V12		;PrABab  V12
	jmp	P12			;[A (B ] b)	A>B
;******************** Закончили с комб. Pr7AB ********
;*************  Pr8
;***************** комб.  P8BA **********
P8BA:
						;границы (B [A
		cmp	cl,ch			;номера младших единичек
	jl	@F				;(B [A a] b)
						;(B [A b)a]
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V13			;
	jmp	P13				;(B [A b)a]	A>B
;***  Координаты границ в Koordint
;*** Закончили с комб. Pr6ABba и пересечение до [A , после до (B, после до b) и до a]
;*******************  			[A     (B	 a]	 b)
@@:						;
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V14 		;(B [A a] b)
	jmp	P14				;      A<B
;************************************
;******************************************************
Pr0:				;JeJ  	;A=0  B=0   A=B
		mov	[Kd+4],0		;EDX= m1, m2, m3, 0
		mov	[Kd+8],0		;[A(B b)a]
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,V1 		;[PrSovm],V1 - признак
	JMP	P1			;A=B
;*****************************
Pr1:				;JmJ	;A=0 B#0 => A<B
		mov	[Kd+4],EDX		;EDX= m1, m2, m3, 0
		mov	[Kd+8],ECX		;+  [A(B b)a]
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS, V2 		;[PrSovm],V2   A<B закончили		признак
	JMP	P2			; A<B
;******************
Pr2:				;JgJ	;A#0 B=0 => A>B
		mov	[Kd+3],EDX		;EDX= m1, m2, m3, 0
		mov	[Kd+8],ECX		;:=   [A(B b)a]
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V3 		;[PrSovm],V3 - признак
	JMP	P3			;A>B
;**************************
Pr3:				;JeJ  	;оба операнда A=B ==>
		bsr	CX,AX			;A
		shl	CX,8
		bsf	DX,BX			;B
		or	CX,DX
		mov	[Kd+4],EDX		;EDX= m1, m2, m3, 0
		mov	[Kd+8],ECX		;$$$[A(B b)a]
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V4		; [PrSovm],V4 -признак
	JMP	P4			;A=B
;************************************ P5 ********************************
Pr4:
;? =  m2/m3  степень совпадения ?   (т.к.  m2 =?( N2 ) =3)
;? =  m1/m3   степень несовпадения ? ( т.к.  m1 = ?( N1 ) =1)
		bsr	CX,AX			;A
		shl	CX,8
		bsr	DX,BX			;B
		or	CX,DX
		shl	ECX,16
		bsf	CX,AX			;A
		shl	CX,8
		bsf	DX,BX			;B
		or	CX,DX
		mov	[Kd+8],ECX		;///[A(B b)a]
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V5 		;[PrSovm],V5	признак
	JMP	P5			;in B=0 A>B
;**********************************************  P6 *********************
Pr5:
;? =  m2/m3  степень совпадения ?   (т.к.  m2 =?( N2 ) =3)
;? =  m1/m3   степень несовпадения ? ( т.к.  m1 = ?( N1 ) =1)
		bsr	CX,AX			;A
		shl	CX,8
		bsr	DX,BX			;B
		or	CX,DX
		shl	ECX,16
		bsf	CX,AX			;A
		shl	CX,8
		bsf	DX,BX			;B
		or	CX,DX
		mov	[Kd+8],ECX		;+=  [A(B b)a]
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V6		; [PrSovm],V6		;признак
	JMP	P6			;in A=0 A<B
;************************************ P6 ********************************
;*********** нет пересекающихся разрядов ***P7 ********************************
Pr6:
		bsf	BP,AX		;A
		shl	BP,8
		bsf	CX,BX		;B
		or	BP,CX		;A  B

		bsr	CX,AX		;A	старшие разряды
		shl	CX,8
 		bsr	DX,BX		; старшие	А  В
		or	CX,DX
		mov	DX,CX		;DX  старшие	А  В
		shl	ECX,16
		mov	CX,BP
		mov	[Kd+8],ECX	;]]границы [A(B b)a]
		cmp	dl,dh		;dl=>B  dh=>A номера старших единичек
	JG	P6BA			;B=1 A=0  =>A<B верхняя B больше A (B [A
					;B=0 A=1  =>A>B
		cmp	cl,ch		;номера младших единичек  [A (B
	jL	@F			;номера младших единичек [(   a] b)
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V7 		;
	jmp	P7			;  	[(  b) a]
@@:
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V8 		;[A (B a]  b)
	jmp	P8			;P72		A>B
;******************** Закончили с комб. P6AB ********
;***************** комб.  PrBA **********
P6BA:
		cmp	cl,ch		;номера младших единичек (B [A
	jL	@F			;(B [A a] b)
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V9 		;(B [A b) a]
	jmp	P9			;	A<B
;************************************
@@:
	ВосстановилиРегистры	EAX,EBX,ECX,EDX,EBP
		mov	PS,_V10 		;(B [A a] b)
	jmp	P10			;A<B
;********************* Закончили**************
}
